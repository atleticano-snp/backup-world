{"_id":"APl27Rtq6DLVCYi8","name":"New Macro","permission":{"default":0,"LJ4R2MrWOYxkXl1W":3},"type":"script","sort":100001,"flags":{"macro-marker":{"activeData":{"icon":"icons/svg/dice-target.svg","tooltip":"New Macro","colour":"#ff0000","trigger":""}},"combat-utility-belt":{"macroTrigger":""}},"scope":"global","command":"(async()=>{\nlet Cub_Condition = game.macros.getName(\"Cub_Condition\");\nlet target = Array.from(game.user.targets)[0];\nlet me = canvas.tokens.controlled[0].actor;\nlet athRoll = await me.rollSkill('ath');\nlet getAcr = target.actor.data.data.skills.acr.total;\nlet getAth = target.actor.data.data.skills.ath.total;\nlet bestSkill = getAcr > getAth ? \"acr\" : \"ath\";\nlet skillRoll = await target.actor.rollSkill(bestSkill);\n\nlet success = \"\";\nif(athRoll.total > skillRoll.total) {\nCub_Condition.execute(target.id, \"Grappled\");\nsuccess = \"Successfully Gappled\";\n} else {\nsuccess = \"Fails to Grapple\";\n}\nlet the_message = `${me.name} ${success} ${target.name}.`;\nChatMessage.create({\n    user: game.user._id,\n    speaker: ChatMessage.getSpeaker({actor: me}),\n    content: the_message,\n});\n})();","author":"LJ4R2MrWOYxkXl1W","img":"icons/svg/dice-target.svg","actorIds":[]}
{"name":"REMOVE CUB Effects","permission":{"default":0,"z3axZ8yAkgVHJACm":3,"pUzzVD4BvVMvqjlV":3},"type":"script","sort":100001,"flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"macro-marker":{"activeData":{"icon":"icons/svg/dice-target.svg","tooltip":"Show Active/Passive Effects","colour":"#ff0000","trigger":""}},"core":{"sourceId":"Macro.SnRtyqW34JPBMHwG"}},"scope":"global","command":"game.cub.removeAllConditions()","author":"pUzzVD4BvVMvqjlV","img":"modules/GMmacros/img/Effect_remove_CUB.png","actorIds":[],"_id":"P44BT9p1ESgcIJoP"}
{"name":"Sneak Attack-Liga/Desliga","permission":{"default":0,"NeG597KOgANJAOdY":3,"pUzzVD4BvVMvqjlV":3},"type":"script","sort":100001,"flags":{"macro-marker":{"activeData":{"icon":"systems/dnd5e/icons/skills/violet_27.jpg","tooltip":"Sneak Attack","colour":"#5945bf","trigger":""},"markers":{"markers":{"7rVA5gxptaEoIlko":false},"type":"Token"}},"combat-utility-belt":{"macroTrigger":""},"core":{"sourceId":"Macro.hqzyhAjIeRfEca6K"}},"scope":"global","command":"//\t\tDISCLAIMER:\t\tThis macro is heavily based on the original D&D 5e Rage Macro masterwork written by Felix#6196.\n//\t\t\t\t\t\tNorc#5108 created and is maintaining this macro.\n//\n//\t\t\t\t\t\tUpdates:\t1.\t2020/06/05: Initial version.\n\n//!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n//!!!\tBonus Tip: Sneak Attack as a Condition                                                                                                                       \n//!!!\tIf you use the Combat Utility Belt module's Condition Lab, try adding a condition called \"Sneaky\" with the same icon \t\t\t   \n//!!!\tas the optional sneak attack icon overlay, 'icons/svg/mystery-man-black.svg' by default.  See EXPERIMENTAL MACRO ICON/NAME TOGGLE below.\n//!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n\n//!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n//!!!   OPTIONAL TOKEN ICON-\tOn by default. If a path to a sneak attack icon is defined, it displays like a condition on the sneaking rogue.\n//!!!\t\t\t\t\t\t\tTo use a different icon, manually change the filepath below or leave it empty ('') to disable the effect.\n//!!!\nconst sneakIconPath = 'systems/dnd5e/icons/skills/violet_27.jpg';\n//!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n\n//!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n//!!!\tEXPERIMENTAL MACRO ICON/NAME TOGGLE\t\tIf enabled, the macro icon and name toggles based on whether the rogue is currently sneaking. \n//!!!\t\t\t\t\t\t\t\t\t\t\tCAUTIONS: \t1. \tThis feature is off by default and is intended for ADVANCED USERS ONLY. \n//!!!\t\t\t\t\t\t\t\t\t\t\t\t\t\t2. \tRequires configuration using \"The Furnace\" module for a player to run!\n//!!!\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tThe GM needs to grant The Furnace's \"Run as GM\" permission for this macro.\n//!!!\t\t\t\t\t\t\t\t\t\t\t\t\t\t3. \tWorks best with only one rogue using this feature at a time.\n\n\t\t\t\t//To auto-toggle the macro's icon/name, override toggleMacro to true below.\n\t\t\t\tconst toggleMacro = false;\n\n\t\t\t\t//To use a different icon, manually change the filepath here\n\t\t\t\tconst stopSneakIconPath = 'icons/svg/cowled.svg';\n\n\t\t\t\t//You must update the following constant to this macro's exact name for the macro icon toggling to work.\n\t\t\t\tconst sneakMacroName = 'Sneak Attack';\n//!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n\nlet toggleResult = false;\nlet enabled = false;\nlet errorReason = '';\nlet sneakAttack = {};\nlet rogue = {};\nlet rogueLvls = 0;\nlet sneakDice = 0;\nlet chatMsg = '';\nlet oldMDmg = '';\nlet oldRDmg = '';\n\nlet macroActor = actor;\nlet macroToken = token;\n\n//!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n//!!!\tBASIC LOCALIZATION SUPPORT\t\t\t\tSets names of D&D5E features as constants instead of hardcoding to allow easier translation.\n//!!!\t\t\t\t\t\t\t\t\t\t\tSets error messages as constants also for easier translation.\n\n\t\t\t\tconst rogueClassName = 'Rogue';\n\t\t\t\tconst sneakAttackFeatureName = 'Sneak Attack';\n\n\t\t\t\tconst errorSelectRogue = 'Please select a single rogue token.';\n\t\t\t\tconst warnMacroNotFound = ' is not a valid macro name, please fix. Sneak attack toggle successful but unable to alter macro.';\n\t\t\t\tconst errorSelectToken = 'Please select a token.';\n//!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\n\n\n//check to ensure token is selected and attempt to define the sneak attack feature\nif (macroActor !== null && macroActor !== undefined) {\n\tsneakAttack = macroActor.items.find(i => i.name == `${sneakAttackFeatureName}`);\n} else {\nerrorReason = `${errorSelectToken}`;\n}\n\n//check to ensure token is a rogue\nif (errorReason == '' && macroActor.items.find(i => i.name == `${rogueClassName}`) !== undefined) {\n\trogue = macroActor.items.find(i => i.name == `${rogueClassName}`);\n} else {\n\terrorReason = `${errorSelectRogue}`;\n}\n\nconsole.log(`Error reason is: ${errorReason}`);\n//main execution now that errors are caught\n\nif (errorReason == '') {\n\t\n\tchatMsg = '';\n\tlet enabled = false;\n\t// store the state of the sneak attack toggle in flags\n\tif (macroActor.data.flags.sneakMacro !== null && macroActor.data.flags.sneakMacro !== undefined) {\n\t\tenabled = true;\n\t}\n\t\n\t// if sneak attack is active, disable it\n\tif (enabled) {\n\t\tchatMsg = `${macroActor.name} is no longer sneak attacking.`;\n\t\t// ranged and melee weapon attack bonus\n\t\tlet obj = {};\n\t\tobj['flags.sneakMacro'] = null;\t\t\n\t\tobj['data.bonuses.mwak.damage'] = macroActor.data.flags.sneakMacro.oldMDmg;\t\t\t\n\t\tobj['data.bonuses.rwak.damage'] = macroActor.data.flags.sneakMacro.oldRDmg;\t\n\t\tmacroActor.update(obj);\n\t\t\n\t// if sneak attack is disabled, enable it\n\t} else {\t\t\n\t\tchatMsg = `${macroActor.name} starts sneak attacking!`;\n\t\t\n\t\tlet obj = {};\n\t\tobj['flags.sneakMacro.enabled'] = true;\n\n\t\t// Preserve old mwak damage bonus if there was one\n\t\tlet oldMDmg = macroActor.data.data.bonuses.mwak.damage;\n\t\tif (oldMDmg==null || oldMDmg == undefined || oldMDmg == '') oldMDmg = 0;\n\t\tobj['flags.sneakMacro.oldMDmg'] = JSON.parse(JSON.stringify(oldMDmg));\n\n\t\t// Preserve old rwak damage bonus if there was one\n\t\tlet oldRDmg = macroActor.data.data.bonuses.rwak.damage;\n\t\tif (oldRDmg==null || oldRDmg == undefined || oldRDmg == '') oldRDmg = 0;\n\t\tobj['flags.sneakMacro.oldRDmg'] = JSON.parse(JSON.stringify(oldRDmg));\n\n\t\t\n\t\t// Determining the rogue level\n\t\trogueLvls = rogue.data.data.levels;\n\n\t\t// Formula to determine the sneak attack damage depending on rogue level\t\n\t\tsneakDice = Math.ceil(rogueLvls/2);\n\t\n\t\t//actually add the bonus sneak attack damage to the previous bonus damage\n\t\t//respect roll formulas if present.\n\t\tif (oldMDmg==null || oldMDmg == undefined || oldMDmg == '' || oldMDmg == 0) {\n\t\t\tobj['data.bonuses.mwak.damage'] = `${sneakDice}d6`;\n\t\t} else {\n\t\t\tobj['data.bonuses.mwak.damage'] = `${oldMDmg} + ${sneakDice}d6`;\n\t\t}\n\n\t\tif (oldRDmg==null || oldRDmg == undefined || oldRDmg == '' || oldRDmg == 0) {\n\t\t\tobj['data.bonuses.rwak.damage'] = `${sneakDice}d6`;\n\t\t} else {\n\t\t\tobj['data.bonuses.rwak.damage'] = `${oldRDmg} + ${sneakDice}d6`;\n\t\t}\t\n\n\t\tmacroActor.update(obj);\n\n\t}\t\n\t\n\t//mark or unmark character's token with Sneaky effect icon, if sneakIconPath is defined\n\t(async () => { \n\t\ttoggleResult = await macroToken.toggleEffect(sneakIconPath);\n\t\tif (toggleResult == enabled) macroToken.toggleEffect(sneakIconPath);  \n\t})();\n\n\t//toggle macro icon and name, if enabled\n\tif (toggleMacro) {\n//\t\tNorc's preferred icons, not sure if publicly available\n//\t\tsneakyMacroImgPath = 'systems/dnd5e/icons/skills/shadow_17.jpg';\n//\t\tstopSneakIconPath = 'systems/dnd5e/icons/skills/yellow_11.jpg';\n\t\tlet sneakMacro = game.macros.getName(sneakMacroName);\n\t\t\t//Also check for name of macro in its \"off\" form\n\t\t\tif (sneakMacro == null || sneakMacro == undefined) {\n\t\t\t\tsneakMacro = game.macros.getName('Stop ' + sneakMacroName);\n\t\t\t}\n\t\tlet obj = {};\n\t\tif ( (sneakMacro !== null && sneakMacro !== undefined) && \n\t\t\t\t+ (stopSneakIconPath !== null && stopSneakIconPath !== undefined && stopSneakIconPath !== '') ) {\n\t\t\tif (enabled) {\n\t\t\tobj['img'] = sneakIconPath;\n\t\t\tobj['name'] = sneakMacroName;\n\t\t\t} else {\n\t\t\tobj['img'] = stopSneakIconPath;\n\t\t\tobj['name'] = 'Stop ' + sneakMacroName;\n\t\t\t}\n\t\t\tsneakMacro.update(obj);\n\t\t} else {\n\t\tui.notifications.warn(`${sneakMacroName} ${warnMacroNotFound}`);\t\t\t\n\t\t}\n\t}\n\n} else {\nui.notifications.error(`${errorReason}`);\t\n}\nif (chatMsg !== '') {\n\tlet chatData = {\n\t\tuser: game.user._id,\n\t\tspeaker: ChatMessage.getSpeaker(),\n\t\tcontent: chatMsg\n\t};\n\tChatMessage.create(chatData, {});\n}\nif (token)\n  MacroMarker.toggle(this, { entity: token });","author":"pUzzVD4BvVMvqjlV","img":"systems/dnd5e/icons/skills/violet_27.jpg","actorIds":[],"_id":"SpMaJnak1pm1pUZo"}
{"name":"AuraAttach","permission":{"default":0,"ccsO3NtPJs2xE1RS":3,"pUzzVD4BvVMvqjlV":3},"type":"script","sort":100001,"flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.16NIuSafXznXfI1E"}},"scope":"global","command":"// Use this macro in the \"On-Use Macro\" Field in the details page (bottom) of the item/spell\n// Requires Token Attacher module\n// Suggested to use Token Magic FX to apply a template animation to the aura/spell when cast and placed down\n\n/* For example: Spirit Guardians. Use this macro in the on-use field and set an animation for the template in Token Magic FX.\nWhen you cast the spell drop it on the canvas with your token at the center. This reads the center location of the template and\nautomatically attaches it to your token\n*/\n\nasync function TemplateAttach() {\n    const templateID = canvas.templates.placeables[canvas.templates.placeables.length - 1].data._id;\n    let template = await canvas.templates.get(templateID);\n    let target_token = canvas.tokens.placeables.find(i => i.center.x === template.center.x && i.center.y === template.center.y);\n    tokenAttacher.attachElementToToken(template, target_token)\n}\nTemplateAttach();","author":"pUzzVD4BvVMvqjlV","img":"icons/svg/target.svg","actorIds":[],"_id":"gduPTlpmrFzTb9ZZ"}
{"name":"Display Attribute Lists for Selected Actor","permission":{"default":0,"NeG597KOgANJAOdY":3,"pUzzVD4BvVMvqjlV":3},"type":"script","sort":100001,"flags":{"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.vIYlN91XcHeOY5KW"}},"scope":"global","command":"ShowActorAttributeData(actor);","author":"pUzzVD4BvVMvqjlV","img":"icons/svg/book.svg","actorIds":[],"_id":"jwpSIO98EVo8zukl"}
{"_id":"xgaPwBavJcDaQ4k7","name":"Cub_Condition","permission":{"default":0,"pUzzVD4BvVMvqjlV":3},"type":"script","sort":100001,"flags":{"macro-marker":{"activeData":{"icon":"icons/svg/dice-target.svg","tooltip":"New Macro","colour":"#ff0000","trigger":""}},"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":true}},"scope":"global","command":"// Add this Callback macro to your GM's hotbar and use Furnace mod to check \"Execute as GM\".\n// You should only pass the target id to this macro\n(async ()=>{\nlet target = canvas.tokens.get(args[0]);\nlet condition = args[1];\nlet state = args[2];\nif (state === \"remove\"){game.cub.removeCondition(condition, target, {warn: false});}\nelse if (state === \"add\"){game.cub.addCondition(condition, target, {warn: false});}\n})();\n\n//### How to Execute the above, do not include this in the pasting into Foundry..####\n//include this line in the headever of whichever macro.\n// => let Cub_Condition = game.macros.getName(\"Cub_Condition\");\n// then use this line to execute it deep in your macro.\n// => Cub_Condition.execute(target, \"Condition\", \"add|remove\");\n// If bulk adding or removal is needed use the following example\n// => let element = [\"condition 1\",\"condition 2\",\"condition 3\"];\n// => Cub_Condition.execute(target, element, \"add|remove\");","author":"pUzzVD4BvVMvqjlV","img":"icons/svg/dice-target.svg","actorIds":[]}
{"_id":"yrTmE5fHVBRsiKmv","name":"Grapple-action","permission":{"default":3,"pUzzVD4BvVMvqjlV":3},"type":"script","sort":100001,"flags":{"macro-marker":{"activeData":{"icon":"icons/svg/dice-target.svg","tooltip":"New Macro","colour":"#ff0000","trigger":""}},"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false}},"scope":"global","command":"(async()=>{\nlet Cub_Condition = game.macros.getName(\"Cub_Condition\");\nlet target = Array.from(game.user.targets)[0];\nlet me = canvas.tokens.controlled[0].actor;\nlet athRoll = await me.rollSkill('ath');\nlet getAcr = target.actor.data.data.skills.acr.total;\nlet getAth = target.actor.data.data.skills.ath.total;\nlet bestSkill = getAcr > getAth ? \"acr\" : \"ath\";\nlet skillRoll = await target.actor.rollSkill(bestSkill, {fastForward : true});\n\nlet success = \"\";\nif(athRoll.total > skillRoll.total) {\nCub_Condition.execute(target.id, \"Grappled\", \"add\");\nsuccess = \"Successfully Gappled\";\n} else {\nsuccess = \"Fails to Grapple\";\n}\nlet the_message = `${me.name} ${success} ${target.name}.`;\nChatMessage.create({\n    user: game.user._id,\n    speaker: ChatMessage.getSpeaker({actor: me}),\n    content: the_message,\n});\n})();","author":"pUzzVD4BvVMvqjlV","img":"modules/combat-utility-belt/icons/grappled.svg","actorIds":[]}
